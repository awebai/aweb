{"id":"aweb-06q","title":"Add parameter validation to chat API methods","description":"Chat API methods could benefit from more thorough parameter validation beyond Pydantic basics. From beadhub-5vr6.","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:02:14Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:02:14Z"}
{"id":"aweb-19j","title":"Add mutation hooks for SSE event publishing","description":"Add fire-and-forget mutation callbacks (app.state.on_mutation) so beadhub can publish SSE events for mail, chat, and reservation mutations. Hook points: message.sent, message.acknowledged, chat.message_sent, reservation.acquired, reservation.released. Bump version to 0.1.5.","status":"closed","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-15T23:09:35Z","created_by":"Juan Reyero","updated_at":"2026-02-15T23:15:11Z","closed_at":"2026-02-15T23:15:11Z","close_reason":"Mutation hooks implemented and tested"}
{"id":"aweb-2af","title":"Fix mark_read allowing backward cursor movement","description":"POST /v1/chat/sessions/{id}/read unconditionally overwrites last_read_message_id even with an older message. A caller can move their read cursor backward, making read messages appear unread. Fix: add WHERE last_read_at IS NULL OR EXCLUDED.last_read_at \u003e last_read_at to the ON CONFLICT clause. Same issue in mcp/tools/chat.py.","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:26Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:26Z"}
{"id":"aweb-2mb","title":"Add 24-hour expiry to rotation announcements per SOT §5.4","description":"SOT §5.4 specifies announcements attach for 24h post-rotation. Current implementation has no time bound — announcements persist forever until the peer responds. Needs design decision on expiry mechanism (SQL WHERE clause on rotated_at, background cleanup, or both).","status":"open","priority":2,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-22T00:44:00Z","created_by":"Juan Reyero","updated_at":"2026-02-22T00:44:00Z"}
{"id":"aweb-2n8","title":"Prepare aweb for PyPI publication","description":"Fix all issues needed before publishing aweb to PyPI: duplicate migrations in wheel, missing routes/__init__.py, missing project.urls/classifiers, add dep minimum versions, rework README for consumers.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-03T23:08:15Z","created_by":"Juan Reyero","updated_at":"2026-02-04T11:28:35Z","closed_at":"2026-02-04T11:28:35Z","close_reason":"PyPI prep complete: sdist/wheel build clean, twine check passes, README accurate, CLAUDE.md excluded"}
{"id":"aweb-2v5","title":"Push conversations cursor pagination into SQL","description":"routes/conversations.py fetches ALL mail and chat rows from DB, then applies cursor filter and limit in Python (lines 170-181). For projects with thousands of messages this is O(N) per page. Push the cursor_dt filter into the SQL WHERE clause for both mail and chat queries.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:48Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:48Z"}
{"id":"aweb-3l0","title":"SSE stream: add after param to skip history replay","description":"Add optional 'after' query param (ISO timestamp) to GET /v1/chat/sessions/{id}/stream. If provided, replay only messages with created_at \u003e after (catches send→SSE race). If not provided, skip replay entirely and poll from now(). Fixes listen bug and eliminates unnecessary history replay overhead.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T11:51:56Z","created_by":"Juan Reyero","updated_at":"2026-02-08T11:56:36Z","closed_at":"2026-02-08T11:56:36Z","close_reason":"Implemented and tested"}
{"id":"aweb-3ty","title":"Version bump to 0.1.2 and notify downstream","description":"Bump pyproject.toml version to 0.1.2. Run all quality gates: pytest, mypy, black, isort, ruff, build, twine check. Notify downstream consumers: alice-coordinator (beadhub events.py orphaned code is now dead), bob-coordinator (aweb 0.1.2 adds sender_waiting), ivy-implementer (aweb 0.1.2 available), henry-implementer (feature shipped, client-side parsing works).","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:35:15Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:48:12Z","closed_at":"2026-02-07T23:48:12Z","close_reason":"Version 0.1.2 built and verified, all quality gates pass","dependencies":[{"issue_id":"aweb-3ty","depends_on_id":"aweb-e2f","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-590","title":"Exclude internal agents (agent_type=human) from list_agents by default","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-08T17:40:01Z","created_by":"Juan Reyero","updated_at":"2026-02-08T17:47:00Z","closed_at":"2026-02-08T17:47:00Z","close_reason":"Implemented and tested"}
{"id":"aweb-59v","title":"Add concurrent lock acquisition tests","description":"No tests for concurrent lock acquisition. Should test: two clients acquire same resource (only one succeeds), transaction rollback doesn't leave inconsistent state. From beadhub-2gn.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:02:21Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:02:21Z"}
{"id":"aweb-5er","title":"Deduplicate bearer token verification per request","description":"get_project_from_auth and get_actor_agent_id_from_auth both independently verify the bearer token (SELECT + UPDATE on api_keys). A single request that calls both hits the table 4 times. Cache the verified result per-request (e.g. on request.state) or merge the two functions.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:20Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:20Z"}
{"id":"aweb-5hb","title":"Broadcast messaging","description":"Allow agents to message all agents in a project at once. API: POST /v1/messages with broadcast flag. Server fans out message to all matching inboxes. Use cases: announcements, repo-wide questions. From beadhub-vpi.","status":"open","priority":4,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:02:33Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:02:33Z"}
{"id":"aweb-5hx","title":"Remove side-effect write from get_pending_announcements","description":"get_pending_announcements writes notified_at rows on every inbox fetch but notified_at is never consulted — acknowledged_at is the real gate. The write should be removed or moved to the caller.","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-22T00:43:53Z","created_by":"Juan Reyero","updated_at":"2026-02-22T00:43:53Z"}
{"id":"aweb-5y5","title":"Un-hardcode targets_connected in POST /v1/chat/sessions","description":"Modify create_or_send() in chat.py: Add redis=Depends(get_redis). After _ensure_session, call get_waiting_agents(redis, session_id, target_ids). Map connected agent_ids back to aliases. Replace targets_connected=[] with actual connected aliases. Tests: test_create_or_send_targets_connected — Agent 2 has active SSE, Agent 1 sends, response includes agent 2's alias in targets_connected. test_create_or_send_targets_connected_empty — No SSE streams, targets_connected is [].","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:35:09Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:46:36Z","closed_at":"2026-02-07T23:46:36Z","close_reason":"All endpoints wired, Lua TOCTOU fix, 24 tests passing","dependencies":[{"issue_id":"aweb-5y5","depends_on_id":"aweb-axv","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-6al","title":"Remove unused bcrypt and email-validator dependencies","description":"bcrypt\u003e=5.0.0 and email-validator\u003e=2.3.0 are declared in pyproject.toml but never imported anywhere in src/aweb/. They add install overhead and false impressions about what the codebase uses. Remove them.","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:37Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:37Z"}
{"id":"aweb-6c5","title":"Write claweb MCP integration guide","description":"Document how claweb should mount the aweb MCP server. Cover: mounting at /mcp, auth bridge integration (CloudAuth middleware), CORS configuration, cross-org routing adapter (network mail/chat tools should route through claweb's network layer for cross-org operations). This is a guide for Frank/claweb team, not end-user docs.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:35:29Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:58:51Z","closed_at":"2026-02-12T14:58:51Z","close_reason":"Integration guide written, proxy-header auth added to MCPAuthMiddleware for claweb compatibility.","dependencies":[{"issue_id":"aweb-6c5","depends_on_id":"aweb-9rr","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-6c5","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-6dn","title":"Implement contacts and locks MCP tools (phase 2)","description":"Second phase tools: contacts_list, contacts_add, contacts_remove, lock_acquire, lock_release, lock_list. Lower priority — implement after core mail/chat/identity tools are working and tested.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:35:36Z","created_by":"Juan Reyero","updated_at":"2026-02-12T15:03:33Z","closed_at":"2026-02-12T15:03:33Z","close_reason":"Contacts (list, add, remove) and locks (acquire, release, list) MCP tools implemented with tests.","dependencies":[{"issue_id":"aweb-6dn","depends_on_id":"aweb-9rr","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-6dn","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-6u9","title":"Fix project lookup to support caller-provided project_id","description":"ensure_project() and bootstrap_identity() match by slug only, causing cross-tenant collisions in cloud mode. Add optional project_id param so callers (beadhub) can pass tenant-scoped IDs.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:17:18Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:23:10Z","closed_at":"2026-02-17T12:23:10Z","close_reason":"Added project_id and tenant_id params to ensure_project() and bootstrap_identity(). Fixed pre-existing bug: migration 005 failed to drop old slug uniqueness index (new migration 012)."}
{"id":"aweb-79x","title":"Implement list_agents MCP tool","description":"Simple tool: list agents in the authenticated project. Calls GET /v1/agents logic directly. Returns alias, agent_id, human_name, agent_type, access_mode for each agent.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:35:09Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:43:36Z","closed_at":"2026-02-12T14:43:36Z","close_reason":"Mail tools, list_agents, heartbeat implemented with tests. Code reviewed - fixed ack_message info disclosure and added priority validation.","dependencies":[{"issue_id":"aweb-79x","depends_on_id":"aweb-8vx","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-79x","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-79x","depends_on_id":"aweb-k8b","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-7jq","title":"Contacts, Access Mode, and Conversations","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-08T09:56:59Z","created_by":"Juan Reyero","updated_at":"2026-02-08T10:07:28Z","closed_at":"2026-02-08T10:07:28Z","close_reason":"All tasks implemented: migration, contacts CRUD, access_mode PATCH, check_access, conversations. 92 tests pass, mypy clean, version 0.1.3."}
{"id":"aweb-8p3","title":"Fix acknowledge_rotation N+1 race — collapse to single INSERT...SELECT","description":"rotation_announcements.py uses fetch-then-loop pattern for acknowledge_rotation. Should be a single INSERT...SELECT to eliminate N+1 race. Flagged by code reviewers.","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-22T00:43:45Z","created_by":"Juan Reyero","updated_at":"2026-02-22T00:43:45Z"}
{"id":"aweb-8vx","title":"Implement whoami MCP tool","description":"First MCP tool — calls /v1/auth/introspect logic to return agent identity (alias, agent_id, project_id, agent_type). Serves as the hello-world for the MCP integration. Includes auth: resolve aw_sk_* API key from MCP request context and authenticate against aweb's existing auth layer.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:34:50Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:35:35Z","closed_at":"2026-02-12T14:35:35Z","close_reason":"whoami tool implemented with tests","dependencies":[{"issue_id":"aweb-8vx","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-8vx","depends_on_id":"aweb-k8b","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-91t","title":"Restore heartbeat endpoint lost in beadhub refactoring","description":"POST /v1/workspaces/heartbeat was dropped when beadhub was refactored from beadhub-main. The presence.py module and its tests survived intact, and routes that call into presence (register, mcp, status, agent listing) still work. But the heartbeat endpoint itself (~249 lines in beadhub-main workspaces.py lines 518-766) is missing.\n\nThe heartbeat endpoint is what the bdh CLI calls to refresh workspace presence. Without it, presence data goes stale and is never refreshed.\n\nReference implementation: beadhub-main/src/beadhub/routes/workspaces.py (search for 'heartbeat').\nRefactored codebase missing it: beadhub/src/beadhub/routes/workspaces.py.\n\nSteps the endpoint performs:\n1. Extract project_id from auth\n2. Pre-check workspace immutability (project_id + alias match)\n3. Resolve/create repo record (normalize git origin)\n4. Upsert workspace record in SQL (immutability constraints, alias collision check via DB + Redis)\n5. Update presence in Redis (best-effort) — hash + secondary indexes\n6. Cloud-only: track usage (non-blocking)\n7. Return OK\n\nPhilosophy: presence is a cache of SQL. SQL authoritative, Redis ephemeral.\n\nNote: only restore the beadhub-specific heartbeat. We discussed with Juan whether presence should live in aweb — conclusion is that workspace-level presence is beadhub-specific (repos, branches, workspace paths). Generic agent-level presence for aweb is a separate future concern.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:27:12Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:27:57Z","closed_at":"2026-02-04T09:27:57Z","close_reason":"Created in wrong beads database (aweb instead of beadhub). Grace will create the issue in beadhub's beads."}
{"id":"aweb-9rr","title":"MCP integration tests","description":"Integration tests for the MCP server module. Test each tool end-to-end: create app with MCP, authenticate with API key, call tools, verify results against the database. Follow existing test patterns (LifespanManager + AsyncClient). Test chat_send with wait:true using a second agent that replies after a short delay. Tests must be pristine — no expected errors in output.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:35:23Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:54:40Z","closed_at":"2026-02-12T14:54:40Z","close_reason":"16 integration tests already written alongside each tool. Full suite (138 tests) green.","dependencies":[{"issue_id":"aweb-9rr","depends_on_id":"aweb-79x","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-9rr","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-9rr","depends_on_id":"aweb-ljj","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-9rr","depends_on_id":"aweb-oir","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-9rr","depends_on_id":"aweb-w1x","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-acs","title":"aweb: replace assert with explicit check in chat session creation","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-03T13:57:44Z","created_by":"Juan Reyero","updated_at":"2026-02-03T14:08:14Z","closed_at":"2026-02-03T14:08:14Z","close_reason":"Replaced assert with explicit check + HTTPException(500) + logging in _ensure_session()"}
{"id":"aweb-aen","title":"Fix regex: backslash allowed in aliases and slugs","description":"PROJECT_SLUG_PATTERN and AGENT_ALIAS_PATTERN in auth.py use \\\\- in raw strings, which allows literal backslash in aliases/slugs. Same issue in routes/contacts.py and mcp/tools/contacts.py CONTACT_ADDRESS_PATTERN. Fix: use r'^[a-zA-Z0-9][a-zA-Z0-9_-]*$' (hyphen at end of char class).","status":"closed","priority":1,"issue_type":"bug","assignee":"jack","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:39:51Z","created_by":"Juan Reyero","updated_at":"2026-02-20T13:19:35Z","closed_at":"2026-02-20T13:19:35Z","close_reason":"Fixed: placed hyphen at end of character class to avoid \\\\- creating a literal backslash. Added 34 regression tests."}
{"id":"aweb-aoq","title":"Fix flaky Redis timing tests (presence + chat SSE)","description":"Three tests fail intermittently due to Redis TTL timing: test_stale_index_entries_cleaned_lazily (presence.py), test_sse_registers_waiting_in_redis, test_sse_message_includes_sender_waiting_true (chat SSE). They rely on asyncio.sleep timing matching Redis key expiry, which is inherently racy under load. Consider using polling/retry loops instead of fixed sleeps, or mock the time.","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-21T23:46:11Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:46:22Z"}
{"id":"aweb-axv","title":"Wire SSE lifecycle tracking into _sse_events","description":"Modify src/aweb/routes/chat.py: Add redis param to _sse_events() signature. ZADD at start (before first yield). Track last_refresh, re-ZADD every 30s in the polling loop. Wrap body in try/finally, ZREM in finally. Add redis=Depends(get_redis) to stream() endpoint, pass to _sse_events. Tests in test_aweb_chat.py: test_sse_registers_waiting_in_redis — start SSE stream with redis, verify ZSCORE exists mid-stream, verify removed after stream ends. Existing redis=None tests must still pass.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:34:58Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:46:36Z","closed_at":"2026-02-07T23:46:36Z","close_reason":"All endpoints wired, Lua TOCTOU fix, 24 tests passing","dependencies":[{"issue_id":"aweb-axv","depends_on_id":"aweb-cva","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-bbc","title":"MCP proxy auth silently falls back to Bearer on tampered headers","description":"In mcp/auth.py _resolve_proxy_auth, when AWEB_TRUST_PROXY_HEADERS=1 and the proxy header fails HMAC validation, the exception is caught and returns None — falling through to Bearer auth. REST layer hard-fails in this case (auth.py:370-378). MCP should match: reject immediately on bad proxy signature, not fall back.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:31Z","created_by":"Juan Reyero","updated_at":"2026-02-18T13:02:34Z","closed_at":"2026-02-18T13:02:34Z","close_reason":"Fixed in edabbd3: proxy mode now rejects on bad HMAC instead of falling through to Bearer"}
{"id":"aweb-boh","title":"Wrap chat session+participant inserts in transaction","description":"In _ensure_session (chat.py), session INSERT and participant INSERTs are separate operations. If participant INSERT fails after session creation, an orphaned session with no participants remains. Should wrap both in a transaction for atomicity. Merges beadhub-nonh and beadhub-1pua.","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:01:28Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:01:28Z"}
{"id":"aweb-c0w","title":"Add authorization check to reservation revoke endpoint","description":"POST /v1/reservations/revoke authenticates the caller but does not check ownership — any agent in the project can force-release other agents' reservations. The actor_id is fetched but prefixed with _ (unused). Either restrict to holder only, add an admin role check, or document the intentional project-wide admin semantics.","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:08Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:08Z"}
{"id":"aweb-col","title":"aweb: fail fast when proxy headers trusted but internal secret missing","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-03T13:57:43Z","created_by":"Juan Reyero","updated_at":"2026-02-03T14:05:48Z","closed_at":"2026-02-03T14:05:48Z","close_reason":"Removed SESSION_SECRET_KEY fallback from _get_aweb_internal_auth_secret(); added validate_auth_config() for startup checks; added logging on runtime failure; added 5 tests to lock behavior"}
{"id":"aweb-cva","title":"Create chat_waiting module with Redis helpers","description":"Create src/aweb/chat_waiting.py with: _chat_waiting_key(session_id) → f'chat:waiting:{session_id}', register_waiting(redis, session_id, agent_id, ttl_seconds=90) — ZADD with time.time() score + EXPIRE, unregister_waiting(redis, session_id, agent_id) — ZREM, is_agent_waiting(redis, session_id, agent_id, max_age_seconds=90) — ZSCORE + stale check + auto-cleanup, get_waiting_agents(redis, session_id, agent_ids, max_age_seconds=90) — pipeline ZSCORE batch returning list of waiting ids. All functions no-op / return defaults when redis is None. Follow presence.py module pattern. Create tests/test_aweb_chat_waiting.py with: test_register_and_check_waiting, test_unregister_waiting, test_stale_entry_detected, test_get_waiting_agents_batch, test_none_redis_graceful.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:34:53Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:37:08Z","closed_at":"2026-02-07T23:37:08Z","close_reason":"chat_waiting.py module + 5 passing tests"}
{"id":"aweb-cxj","title":"MCP server support for aweb","description":"Implement Model Context Protocol (MCP) server support in the aweb Python package. This enables agents in sandboxed environments (e.g. Anthropic Cowork) to use aweb coordination via MCP tool calls instead of the aw CLI, which is blocked by sandbox network restrictions. The MCP server uses Streamable HTTP transport, is colocated in the aweb package, and claweb mounts it at /mcp alongside the existing /api mount. The aw Go CLI remains the primary path for unrestricted environments.","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:34:30Z","created_by":"Juan Reyero","updated_at":"2026-02-18T12:58:24Z","closed_at":"2026-02-18T12:58:24Z","close_reason":"All 9 children completed"}
{"id":"aweb-du2","title":"SSE polling interval is 100ms — consider adaptive or pub/sub","description":"routes/chat.py _sse_events polls DB every 100ms (line 723) for new messages and read receipts. At 50+ concurrent streams this generates significant DB load. MCP uses 500ms inconsistently. Consider: adaptive polling (start slow, speed up on activity), Redis pub/sub, or PostgreSQL LISTEN/NOTIFY.","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:54Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:54Z"}
{"id":"aweb-dxv","title":"Cache Lua scripts with EVALSHA instead of EVAL","description":"chat_waiting.py uses redis.eval() sending the full Lua script body on every call. Should use SCRIPT LOAD + EVALSHA for reduced Redis CPU. Handle NOSCRIPT fallback. From beadhub-lbj.","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:02:27Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:02:27Z"}
{"id":"aweb-e2f","title":"Add sender_waiting to GET /v1/chat/sessions","description":"Modify list_sessions() in chat.py: Add sender_waiting: bool = False to SessionListItem model. Add redis=Depends(get_redis) to endpoint. Add agent_id aggregation to SQL query. For each session, check if any non-self participant is waiting via get_waiting_agents. Tests: test_list_sessions_sender_waiting — Agent 1 has active SSE, Agent 2's session list shows sender_waiting: True.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:35:11Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:46:36Z","closed_at":"2026-02-07T23:46:36Z","close_reason":"All endpoints wired, Lua TOCTOU fix, 24 tests passing","dependencies":[{"issue_id":"aweb-e2f","depends_on_id":"aweb-axv","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-fj2","title":"[EPIC] Implement identity architecture (DID/signing) in aweb","description":"Add cryptographic identity to aweb per clawdid/sot.md v3. Each agent gets an Ed25519 keypair and did:key. Messages are signed. Server supports custodial and self-custodial key management, persistent and ephemeral agent lifetimes, key rotation with announcements, agent retirement with succession, and ephemeral agent deregistration. Cross-project agent resolution endpoint. All additive and backward-compatible. Blocked by: nothing. Blocks: claweb refactor to stop direct aweb-table INSERTs (quinn's work). See docs/identity-implementation.md for full local SOT.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:21:24Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:45:53Z","closed_at":"2026-02-21T23:45:53Z","close_reason":"All 19 sub-beads implemented and merged. Full identity architecture: DID generation, signing/verification, 4 migrations, custody, init, resolve, message relay, agent listing, custodial signing, rotation with announcements, retirement, deregistration, audit log, MCP tools, mutation events. 328 tests pass."}
{"id":"aweb-fj2.1","title":"Add did.py: Ed25519 keypair generation and did:key encoding","description":"New module src/aweb/did.py. Add PyNaCl and base58 dependencies. Functions: generate_keypair() -\u003e (private_key, public_key), did_from_public_key(public_key: bytes) -\u003e str (multicodec 0xed01 prefix + base58btc), public_key_from_did(did: str) -\u003e bytes, validate_did(did: str) -\u003e bool. Per clawdid/sot.md §2.2. TDD: write tests first.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:22:58Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:16:53Z","closed_at":"2026-02-21T22:16:53Z","close_reason":"did.py implemented with 20 passing tests. Code-reviewed.","dependencies":[{"issue_id":"aweb-fj2.1","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:22:58Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.10","title":"Update message endpoints to accept/store/return DID and signature fields","description":"Update POST /v1/messages and POST /v1/chat/sessions/{id}/messages to accept optional fields: from_did, to_did, signature, signing_key_id, rotation_announcement. Store verbatim — server NEVER modifies, strips, or re-signs. Return these fields in: inbox responses, chat history, SSE stream events. If AWEB_VERIFY_SIGNATURES_ON_INGEST=1, verify signature on ingest and log warning if invalid (but still deliver). TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:24:44Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:41:49Z","closed_at":"2026-02-21T22:41:49Z","close_reason":"All review issues fixed: SSE identity fields, max_length constraints, SSE test. 240 tests pass.","dependencies":[{"issue_id":"aweb-fj2.10","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:24:43Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.10","depends_on_id":"aweb-fj2.4","type":"blocks","created_at":"2026-02-21T21:27:05Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.10","depends_on_id":"aweb-fj2.5","type":"blocks","created_at":"2026-02-21T21:27:08Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.11","title":"Transparent server-side signing for custodial agent messages","description":"When a custodial agent sends a message (REST or MCP) and AWEB_CUSTODY_KEY is configured: look up agent's encrypted private key, decrypt, build canonical payload from message fields, sign with Ed25519, attach from_did + signature + signing_key_id to stored message. Transparent to caller. Uses custody.py sign_on_behalf(). Must work for both mail (POST /v1/messages) and chat (POST /v1/chat/sessions/{id}/messages). TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:24:55Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:05:59Z","closed_at":"2026-02-21T23:05:59Z","close_reason":"Implemented transparent server-side signing for custodial agents in messages.py and chat.py. All 284 tests pass.","dependencies":[{"issue_id":"aweb-fj2.11","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:24:55Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.11","depends_on_id":"aweb-fj2.10","type":"blocks","created_at":"2026-02-21T21:27:18Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.11","depends_on_id":"aweb-fj2.8","type":"blocks","created_at":"2026-02-21T21:27:15Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.12","title":"Rotation announcement: store on rotation, inject into outgoing messages per-peer until acknowledged","description":"On key rotation: store rotation_announcement JSON (old_did, new_did, timestamp, old_key_signature) in agent record. old_key_signature is Ed25519 signature by OLD key over canonical JSON of {new_did, old_did, timestamp}. Server attaches rotation_announcement to all outgoing messages from that agent TO EACH PEER until that peer sends a message back to the rotated agent. Per-peer tracking: server records which peers have been notified per rotation event; once a peer responds (any message to the rotated address), stop attaching announcement to that peer. This requires a tracking table or column (e.g. rotation_peer_notifications with rotation_event_id, peer_agent_id, notified_at, acknowledged_at). Enables receivers to auto-accept legitimate rotations without IDENTITY_MISMATCH warnings. Per clawdid/sot.md §5.4. Persistent agents only. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:25:07Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:19:56Z","closed_at":"2026-02-21T23:19:56Z","close_reason":"Implemented rotation announcement storage, per-peer injection into inbox, and implicit acknowledgment on reply. Migration 017, rotation_announcements.py, inbox injection in messages.py. 5 tests, 291 total green.","dependencies":[{"issue_id":"aweb-fj2.12","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:25:06Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.12","depends_on_id":"aweb-fj2.13","type":"blocks","created_at":"2026-02-21T21:27:31Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.12","depends_on_id":"aweb-fj2.4","type":"blocks","created_at":"2026-02-21T21:27:25Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.12","depends_on_id":"aweb-fj2.5","type":"blocks","created_at":"2026-02-21T21:27:28Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.13","title":"Add PUT /v1/agents/{agent_id}/rotate — key rotation endpoint","description":"Persistent agents only — reject with 400 if agent.lifetime=ephemeral. Request: new_did, new_public_key, custody, rotation_proof (Ed25519 sig by OLD key over canonical {new_did, old_did, operation:rotate, timestamp}). Verify rotation_proof against current public_key. For custodial agents: server signs proof on behalf. Update agent record: new DID, new public_key, new custody. If graduating custodial→self: destroy encrypted private key. Append 'rotate' entry to agent_log. Store rotation announcement for injection. Response: status=rotated, old_did, new_did, custody. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:25:18Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:54:00Z","closed_at":"2026-02-21T22:54:00Z","close_reason":"Closed","dependencies":[{"issue_id":"aweb-fj2.13","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:25:18Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.13","depends_on_id":"aweb-fj2.1","type":"blocks","created_at":"2026-02-21T21:27:39Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.13","depends_on_id":"aweb-fj2.2","type":"blocks","created_at":"2026-02-21T21:27:42Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.13","depends_on_id":"aweb-fj2.3","type":"blocks","created_at":"2026-02-21T21:27:45Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.13","depends_on_id":"aweb-fj2.6","type":"blocks","created_at":"2026-02-21T21:27:48Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.14","title":"Add PUT /v1/agents/{agent_id}/retire — retirement with successor","description":"Persistent agents only — reject with 400 if agent.lifetime=ephemeral. Request: successor_agent_id, retirement_proof (Ed25519 sig by retiring agent's key over canonical {operation:retire, successor_agent_id, timestamp}). Verify proof against agent's current public_key. For custodial: server signs on behalf. Set status='retired', successor_agent_id. Append 'retire' entry to agent_log with successor metadata. Messages to retired agents return retirement notice + successor info. Per clawdid/sot.md §5.2. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:25:30Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:30:54Z","closed_at":"2026-02-21T23:30:54Z","close_reason":"Implemented retirement endpoint with 9 tests. Code reviewer passed — fixed self-succession guard and signature storage.","dependencies":[{"issue_id":"aweb-fj2.14","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:25:30Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.14","depends_on_id":"aweb-fj2.3","type":"blocks","created_at":"2026-02-21T21:27:57Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.14","depends_on_id":"aweb-fj2.6","type":"blocks","created_at":"2026-02-21T21:27:59Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.15","title":"Add DELETE /v1/agents/{agent_id} — ephemeral agent deregistration","description":"Ephemeral agents only — reject with 400 if agent.lifetime=persistent (use retire instead). Auth: any authenticated agent in the same project can call this (peer-callable, needed for stale workspace cleanup by other agents). Destroy encrypted signing key (signing_key_enc). Set status='deregistered'. Free the alias for reuse (set deleted_at so unique constraint allows reuse). Append 'deregister' entry to agent_log. Fire agent.deregistered mutation event. No successor link, no rotation log. Per clawdid/sot.md §4.6 and beadhub contract (alice). TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:25:40Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:45:11Z","closed_at":"2026-02-21T22:45:11Z","close_reason":"Closed","dependencies":[{"issue_id":"aweb-fj2.15","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:25:40Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.15","depends_on_id":"aweb-fj2.3","type":"blocks","created_at":"2026-02-21T21:28:06Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.15","depends_on_id":"aweb-fj2.6","type":"blocks","created_at":"2026-02-21T21:28:09Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.16","title":"Add GET /v1/agents/{agent_id}/log — lifecycle audit trail","description":"Returns append-only lifecycle log for an agent. Response: agent_id, address (namespace/alias), log array of {log_id, operation, old_did, new_did, signed_by, entry_signature, metadata, created_at}. Ordered by created_at ASC. Ephemeral agents: minimal log (create + deregister). Persistent agents: full log (create, rotate, retire, custody_change). Authenticated, project-scoped. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:25:50Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:49:59Z","closed_at":"2026-02-21T22:49:59Z","close_reason":"Closed","dependencies":[{"issue_id":"aweb-fj2.16","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:25:49Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.16","depends_on_id":"aweb-fj2.6","type":"blocks","created_at":"2026-02-21T21:28:16Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.17","title":"Update GET /v1/agents to include DID/identity fields","description":"Add to per-agent response: did (nullable), custody (nullable), lifetime, status. Existing fields unchanged. Backward compatible — new fields are additive.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:26:00Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:55:39Z","closed_at":"2026-02-21T22:55:39Z","close_reason":"All review issues addressed. 279 tests pass.","dependencies":[{"issue_id":"aweb-fj2.17","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:25:59Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.17","depends_on_id":"aweb-fj2.3","type":"blocks","created_at":"2026-02-21T21:28:24Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.18","title":"Update MCP tools for identity fields","description":"whoami: include did, custody, lifetime in response. list_agents: include did, custody, lifetime, status per agent. send_mail + chat_send: for custodial agents trigger server-side signing (transparent); for self-custodial accept signature + signing_key_id in tool arguments. New optional MCP tools (not blocking launch): agent_resolve, agent_log.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:26:11Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:26:44Z","closed_at":"2026-02-21T23:26:44Z","close_reason":"whoami returns did/custody/lifetime, list_agents includes did/custody/lifetime/status, check_inbox includes signing fields","dependencies":[{"issue_id":"aweb-fj2.18","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:26:11Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.18","depends_on_id":"aweb-fj2.11","type":"blocks","created_at":"2026-02-21T21:28:32Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.18","depends_on_id":"aweb-fj2.17","type":"blocks","created_at":"2026-02-21T21:28:34Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.19","title":"Add mutation events for identity lifecycle","description":"Fire on_mutation events for identity lifecycle operations via app.state.on_mutation hook. Events: agent.created (in bootstrap_identity, includes did, custody, lifetime), agent.deregistered (in DELETE /v1/agents/{agent_id}), agent.key_rotated (in PUT /v1/agents/{agent_id}/rotate, persistent only), agent.retired (in PUT /v1/agents/{agent_id}/retire, persistent only). BeadHub depends on agent.created and agent.deregistered for SSE dashboard updates. Fire agent.created in step 3 (registration) and agent.deregistered in step 5 (deregistration). Pattern: follow existing mutation events (message.sent, chat.message_sent, reservation.acquired). TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:53:52Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:39:34Z","closed_at":"2026-02-21T23:39:34Z","close_reason":"All 4 mutation events implemented and tested: agent.created (init.py), agent.key_rotated (agents.py), agent.deregistered (agents.py), agent.retired (agents.py, by Mia). 13 hook tests.","dependencies":[{"issue_id":"aweb-fj2.19","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:53:52Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.19","depends_on_id":"aweb-fj2.13","type":"blocks","created_at":"2026-02-21T21:54:06Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.19","depends_on_id":"aweb-fj2.14","type":"blocks","created_at":"2026-02-21T21:54:09Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.19","depends_on_id":"aweb-fj2.15","type":"blocks","created_at":"2026-02-21T21:54:03Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.19","depends_on_id":"aweb-fj2.7","type":"blocks","created_at":"2026-02-21T21:54:00Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.2","title":"Add signing.py: canonical JSON payload, Ed25519 signing and verification","description":"New module src/aweb/signing.py. Functions: canonical_payload(fields: dict) -\u003e bytes (lexicographic key sort, no whitespace, literal UTF-8 for non-ASCII, no \\uXXXX escapes, per clawdid/sot.md §4.2), sign_message(private_key: bytes, payload: bytes) -\u003e str (base64 no-padding), verify_signature(did: str, payload: bytes, signature_b64: str) -\u003e VerifyResult (VERIFIED/VERIFIED_CUSTODIAL/UNVERIFIED/FAILED). Signed payload fields (8 total): body, from, from_did, subject, timestamp, to, to_did, type. Transport fields excluded: signature, signing_key_id, server, rotation_announcement. VERIFIED_CUSTODIAL means signature is valid but the signing key is server-held (custodial agent) — caller uses resolution metadata to distinguish. TDD: write tests first.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:23:10Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:26:48Z","closed_at":"2026-02-21T22:26:48Z","close_reason":"signing.py implemented, reviewed by sam. 21 tests, standard base64, UNVERIFIED/FAILED split per spec.","dependencies":[{"issue_id":"aweb-fj2.2","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:23:10Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.3","title":"Migration 013: add DID/identity columns to agents table","description":"Add nullable columns to agents table: did TEXT, public_key TEXT, custody TEXT CHECK IN ('self','custodial'), signing_key_enc BYTEA (encrypted private key for custodial), lifetime TEXT DEFAULT 'persistent' CHECK IN ('persistent','ephemeral'), status TEXT DEFAULT 'active' CHECK IN ('active','retired','deregistered'), successor_agent_id UUID FK to agents. Indexes: UNIQUE(project_id, did) WHERE deleted_at IS NULL AND did IS NOT NULL; idx_agents_did. All nullable for backward compat with pre-DID agents.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:23:22Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:27:38Z","closed_at":"2026-02-21T22:27:38Z","close_reason":"Migrations 013-016 implemented and tested. All 232 tests pass.","dependencies":[{"issue_id":"aweb-fj2.3","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:23:21Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.4","title":"Migration 014: add DID/signature columns to messages table","description":"Add nullable columns to messages table: from_did TEXT, to_did TEXT, signature TEXT (base64 Ed25519), signing_key_id TEXT (DID of signing key), rotation_announcement JSONB (contains old_did, new_did, timestamp, old_key_signature per clawdid/sot.md §5.4). All nullable — unsigned messages remain valid.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:23:32Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:27:38Z","closed_at":"2026-02-21T22:27:38Z","close_reason":"Migrations 013-016 implemented and tested. All 232 tests pass.","dependencies":[{"issue_id":"aweb-fj2.4","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:23:31Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.5","title":"Migration 015: add DID/signature columns to chat_messages table","description":"Same columns as migration 014 but on chat_messages: from_did TEXT, to_did TEXT, signature TEXT, signing_key_id TEXT, rotation_announcement JSONB. All nullable.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:23:41Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:27:38Z","closed_at":"2026-02-21T22:27:38Z","close_reason":"Migrations 013-016 implemented and tested. All 232 tests pass.","dependencies":[{"issue_id":"aweb-fj2.5","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:23:41Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.6","title":"Migration 016: create agent_log table for lifecycle audit trail","description":"New table agent_log: log_id UUID PK, agent_id UUID FK, project_id UUID, operation TEXT NOT NULL ('create','rotate','retire','deregister','custody_change'), old_did TEXT, new_did TEXT, signed_by TEXT (DID that authorized entry), entry_signature TEXT (base64 Ed25519), metadata JSONB (successor_address, etc.), created_at TIMESTAMPTZ DEFAULT NOW(). Index on (agent_id, created_at). Ephemeral agents: minimal log (create + deregister only).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:23:54Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:27:38Z","closed_at":"2026-02-21T22:27:38Z","close_reason":"Migrations 013-016 implemented and tested. All 232 tests pass.","dependencies":[{"issue_id":"aweb-fj2.6","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:23:54Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.7","title":"Update /v1/init to accept DID, public_key, custody, lifetime","description":"Update POST /v1/init and bootstrap.py. New optional request fields: did, public_key, custody (self|custodial), lifetime (persistent|ephemeral, default persistent). Self-custodial path: validate DID matches public_key (re-derive and compare), store both. Custodial path: server generates keypair via did.py, computes DID, stores encrypted private key. Legacy path (no DID fields): works as today, agent has no DID. New response fields: did (nullable), custody (nullable), lifetime. Write agent_log 'create' entry. This bead unblocks quinn's claweb refactor. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:24:09Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:55:39Z","closed_at":"2026-02-21T22:55:39Z","close_reason":"All review issues addressed. 279 tests pass.","dependencies":[{"issue_id":"aweb-fj2.7","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:24:08Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.7","depends_on_id":"aweb-fj2.1","type":"blocks","created_at":"2026-02-21T21:26:33Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.7","depends_on_id":"aweb-fj2.2","type":"blocks","created_at":"2026-02-21T21:26:36Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.7","depends_on_id":"aweb-fj2.3","type":"blocks","created_at":"2026-02-21T21:26:39Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.8","title":"Add custody.py: encrypted key storage and server-side signing","description":"New module src/aweb/custody.py. Encryption: AES-256-GCM with AWEB_CUSTODY_KEY env var as master key. Functions: encrypt_signing_key(private_key, master_key) -\u003e bytes, decrypt_signing_key(encrypted, master_key) -\u003e bytes, sign_on_behalf(agent_id, message_fields, db) -\u003e str (decrypt key, build canonical payload, sign, return base64 signature). If AWEB_CUSTODY_KEY not configured, custodial signing is disabled (messages stored unsigned). Destroy key on graduation to self-custodial. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:24:20Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:40:50Z","closed_at":"2026-02-21T22:40:50Z","close_reason":"Closed","dependencies":[{"issue_id":"aweb-fj2.8","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:24:20Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.8","depends_on_id":"aweb-fj2.1","type":"blocks","created_at":"2026-02-21T21:26:46Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.8","depends_on_id":"aweb-fj2.2","type":"blocks","created_at":"2026-02-21T21:26:49Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-fj2.9","title":"Add GET /v1/agents/resolve/{namespace}/{alias} — cross-project resolution","description":"New endpoint in routes/agents.py (or new routes/resolve.py). Authenticated but NOT project-scoped — exception to normal scoping, agreed with quinn. Looks up project by slug (namespace), then agent by alias. Returns: did, address (namespace/alias), agent_id, human_name, public_key, server (from AWEB_SERVER_URL), custody, lifetime, status. Returns 404 if agent not found/deleted. Per clawdid/sot.md §4.6. TDD.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T21:24:32Z","created_by":"Juan Reyero","updated_at":"2026-02-21T22:40:50Z","closed_at":"2026-02-21T22:40:50Z","close_reason":"Closed","dependencies":[{"issue_id":"aweb-fj2.9","depends_on_id":"aweb-fj2","type":"parent-child","created_at":"2026-02-21T21:24:31Z","created_by":"Juan Reyero","metadata":"{}"},{"issue_id":"aweb-fj2.9","depends_on_id":"aweb-fj2.3","type":"blocks","created_at":"2026-02-21T21:26:57Z","created_by":"Juan Reyero","metadata":"{}"}]}
{"id":"aweb-gj7","title":"Add rate limiting to endpoints","description":"No rate limiting on any aweb endpoints. Chat polling and admin endpoints could hammer the database. Consider adding rate limiting middleware. From beadhub-qm84.","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:02:08Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:02:08Z"}
{"id":"aweb-gkv","title":"Epic: Agent-level presence and heartbeat for aweb","description":"aweb needs agent-level presence so that:\n- aw list-agents returns accurate online status (currently always offline)\n- Chat/mail senders can check recipient availability\n- beadhub's workspace heartbeat can sync to aweb's agent presence\n\nArchitecture: Redis-backed presence with TTL at the agent_id level. Simpler than beadhub's workspace presence (no repos, branches, workspace paths). beadhub's workspace heartbeat should also update aweb's agent presence as a side-effect.\n\nIncludes aweb server changes and aw Go client changes. beadhub integration tracked separately in beadhub's beads.","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:30:28Z","created_by":"Juan Reyero","updated_at":"2026-02-04T10:08:58Z","closed_at":"2026-02-04T10:08:58Z","close_reason":"All 6 sub-tasks complete: presence module, endpoints, client, CLI, and tests"}
{"id":"aweb-gkv.1","title":"Add GET /v1/agents endpoint","description":"aweb has no agent listing endpoint. The aw Go client (agents.go) calls GET /v1/agents and expects a ListAgentsResponse with project_id and a list of AgentView (agent_id, alias, human_name, agent_type, status, last_seen, online).\n\nThe endpoint should:\n- Require auth (Bearer API key)\n- Scope to the authenticated project_id\n- Query the agents table for all non-deleted agents in the project\n- Return the list matching the AgentView shape from aw/agents.go\n\nThis is needed independently of presence — even without online status, users need to list agents in their project.\n\nNote: the online/last_seen fields will be empty until presence is implemented (aweb-gkv children).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:12Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:56:08Z","closed_at":"2026-02-04T09:56:08Z","close_reason":"Implemented and tested: GET /v1/agents + presence module. 13 new tests passing.","dependencies":[{"issue_id":"aweb-gkv.1","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-gkv.2","title":"Add agent presence module (Redis)","description":"Create src/aweb/presence.py — a Redis-backed agent presence module. Simpler than beadhub's workspace presence (no repos, branches, workspace paths).\n\nRedis data structures:\n- presence:agent:{agent_id} → Hash {agent_id, alias, project_id, status, last_seen} with TTL (default 30 min)\n- idx:project_agents:{project_id} → Set of agent_ids with active presence (2x TTL for lazy cleanup)\n\nFunctions needed:\n- update_agent_presence(redis, agent_id, alias, project_id, status='active', ttl_seconds=1800) → timestamp\n- get_agent_presence(redis, agent_id) → Optional dict\n- list_agent_presences_by_project(redis, project_id) → List of dicts\n- list_agent_presences_by_ids(redis, agent_ids) → List of dicts (for enriching agent listings)\n- clear_agent_presence(redis, agent_ids) → count deleted\n\nFollow the patterns from beadhub-main's presence.py but strip all workspace/repo/branch-specific code. Keep: URL-encoded key components, lazy stale index cleanup, pipeline batching, 2x TTL on indexes.\n\nRedis is optional in aweb (app.state.redis can be None). All presence functions must handle redis=None gracefully (return empty results).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:23Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:56:08Z","closed_at":"2026-02-04T09:56:08Z","close_reason":"Implemented and tested: GET /v1/agents + presence module. 13 new tests passing.","dependencies":[{"issue_id":"aweb-gkv.2","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-gkv.3","title":"Add POST /v1/agents/heartbeat endpoint","description":"Add a heartbeat endpoint that agents call to report liveness.\n\nPOST /v1/agents/heartbeat\n- Requires auth (Bearer API key) → resolves project_id and agent_id\n- Request body: optional fields (status: str)\n- Calls update_agent_presence() from the presence module\n- Returns {agent_id, last_seen, ttl_seconds}\n- Best-effort: if Redis is unavailable, log warning and return success (SQL is authoritative, presence is a cache)\n\nThis is simpler than beadhub's workspace heartbeat — no repo resolution, no immutability checks, no SQL upsert. Just 'I am alive, refresh my TTL.'\n\nDepends on: aweb-gkv.2 (presence module)","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:31Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:58:53Z","closed_at":"2026-02-04T09:58:53Z","close_reason":"Heartbeat endpoint implemented with 4 tests. Agent listing enrichment was already done in aweb-gkv.1.","dependencies":[{"issue_id":"aweb-gkv.3","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-gkv.3","depends_on_id":"aweb-gkv.2","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-gkv.4","title":"Enrich GET /v1/agents with online status from presence","description":"Update the GET /v1/agents endpoint (aweb-gkv.1) to enrich agent listings with online/last_seen from the presence module (aweb-gkv.2).\n\nAfter fetching agents from the DB, call list_agent_presences_by_ids() to get presence data. For each agent, set:\n- online: bool (true if presence exists and not expired)\n- last_seen: ISO timestamp from presence, or null\n\nWhen Redis is unavailable (app.state.redis is None), online=false and last_seen=null for all agents.\n\nThe aw Go client's AgentView struct already expects these fields:\n  Online    bool   json:online\n  LastSeen  string json:last_seen,omitempty\n  Status    string json:status,omitempty\n\nDepends on: aweb-gkv.1 (agents endpoint), aweb-gkv.2 (presence module)","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:39Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:58:53Z","closed_at":"2026-02-04T09:58:53Z","close_reason":"Heartbeat endpoint implemented with 4 tests. Agent listing enrichment was already done in aweb-gkv.1.","dependencies":[{"issue_id":"aweb-gkv.4","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-gkv.4","depends_on_id":"aweb-gkv.1","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-gkv.4","depends_on_id":"aweb-gkv.2","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-gkv.5","title":"aw client: add Heartbeat() method","description":"Add a Heartbeat() method to the aw Go client (aw/client.go).\n\nfunc (c *Client) Heartbeat(ctx context.Context, req *HeartbeatRequest) (*HeartbeatResponse, error)\n\ntype HeartbeatRequest struct {\n    Status string `json:\"status,omitempty\"`\n}\n\ntype HeartbeatResponse struct {\n    AgentID  string `json:\"agent_id\"`\n    LastSeen string `json:\"last_seen\"`\n    TTL      int    `json:\"ttl_seconds\"`\n}\n\nCalls POST /v1/agents/heartbeat with Bearer API key auth.\n\nDepends on: aweb-gkv.3 (heartbeat endpoint exists)","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:44Z","created_by":"Juan Reyero","updated_at":"2026-02-04T10:07:41Z","closed_at":"2026-02-04T10:07:41Z","close_reason":"Heartbeat client method + CLI goroutine implemented, tested, committed, pushed","dependencies":[{"issue_id":"aweb-gkv.5","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-gkv.5","depends_on_id":"aweb-gkv.3","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-gkv.6","title":"aw CLI: call heartbeat on every command","description":"Integrate heartbeat into the aw CLI (aw/cmd/aw/main.go), similar to how bdh calls refreshPresenceHeartbeat() on every command.\n\nOn every aw CLI invocation:\n1. Load config (API key, base URL)\n2. Call client.Heartbeat() in a goroutine (best-effort, non-blocking)\n3. Don't fail the command if heartbeat fails (log warning at most)\n\nThis ensures that any agent using aw stays visible in presence as long as they're actively running commands.\n\nDepends on: aweb-gkv.5 (aw client Heartbeat method)","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:51Z","created_by":"Juan Reyero","updated_at":"2026-02-04T10:07:41Z","closed_at":"2026-02-04T10:07:41Z","close_reason":"Heartbeat client method + CLI goroutine implemented, tested, committed, pushed","dependencies":[{"issue_id":"aweb-gkv.6","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-gkv.6","depends_on_id":"aweb-gkv.5","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-hea","title":"Fix LIKE injection in reservation prefix queries","description":"revoke and list_reservations endpoints use LIKE ($2 || '%') without escaping % and _ metacharacters. An agent can send prefix=% to match all reservations in their project. Affects routes/reservations.py (revoke and list) and mcp/tools/locks.py. Fix: escape %, _, and \\ in prefix before LIKE, or use starts_with via position()/left().","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:39:57Z","created_by":"Juan Reyero","updated_at":"2026-02-20T13:21:51Z","closed_at":"2026-02-20T13:21:51Z","close_reason":"Closed"}
{"id":"aweb-j6z","title":"Fix N+1 query in chat alias resolution","description":"In create_or_send (chat.py:226-229), _get_agent_by_alias is called in a loop for each alias in to_aliases. Should batch resolve all aliases in a single query using ANY($1::text[]). From beadhub-zcw7.","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:01:40Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:01:40Z"}
{"id":"aweb-k8b","title":"Add MCP Python SDK dependency and scaffold module","description":"Add the mcp Python SDK to aweb's dependencies. Create src/aweb/mcp/ module with __init__.py, server.py (MCP app factory), and tools/ subpackage. The MCP app factory should follow the same pattern as create_app() in api.py — accepting db_infra and redis params. Wire up Streamable HTTP transport.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:34:44Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:35:35Z","closed_at":"2026-02-12T14:35:35Z","close_reason":"Scaffold done: mcp SDK dep, module structure, auth middleware, server factory","dependencies":[{"issue_id":"aweb-k8b","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-kki","title":"Extract shared service layer for chat, reservations, contacts","description":"Business logic is duplicated between REST routes and MCP tools: _ensure_session, _send_in_session, _clamp_ttl, _decode_metadata, _participant_hash, HANG_ON_EXTENSION_SECONDS, mark_read logic, CONTACT_ADDRESS_PATTERN. messages_service.py shows the right pattern. Extract shared services so bug fixes propagate to both layers.","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-17T12:40:03Z","created_by":"Juan Reyero","updated_at":"2026-02-17T12:40:03Z"}
{"id":"aweb-ljj","title":"Implement mail MCP tools (send_mail, check_inbox, ack_message)","description":"Three mail tools: send_mail (POST /v1/messages — to_alias, subject, body, priority), check_inbox (GET /v1/messages/inbox — unread_only filter), ack_message (POST /v1/messages/{id}/ack). These call aweb service functions directly, not HTTP. Auth context from the MCP session provides project_id and agent_id.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:34:56Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:43:36Z","closed_at":"2026-02-12T14:43:36Z","close_reason":"Mail tools, list_agents, heartbeat implemented with tests. Code reviewed - fixed ack_message info disclosure and added priority validation.","dependencies":[{"issue_id":"aweb-ljj","depends_on_id":"aweb-8vx","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-ljj","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-ljj","depends_on_id":"aweb-k8b","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-oik","title":"Add unit tests for _participant_hash","description":"No unit tests for _participant_hash() in chat.py. Test cases: different orderings produce same hash, duplicate IDs are handled, etc. From beadhub-el1r.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:01:46Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:01:46Z"}
{"id":"aweb-oir","title":"Implement heartbeat piggybacking on MCP tool calls","description":"The aweb protocol requires periodic heartbeats for presence. The MCP server should fire a heartbeat whenever a tool is called (piggyback on existing requests). This keeps the agent marked as online without a background task. Call the heartbeat logic directly from the MCP request lifecycle.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:35:16Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:43:36Z","closed_at":"2026-02-12T14:43:36Z","close_reason":"Mail tools, list_agents, heartbeat implemented with tests. Code reviewed - fixed ack_message info disclosure and added priority validation.","dependencies":[{"issue_id":"aweb-oir","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-oir","depends_on_id":"aweb-k8b","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-oqm","title":"conversations.py: silent cursor parse error should return 422","description":"In routes/conversations.py ~line 49, malformed cursor values are silently swallowed (except: cursor_dt = None) instead of returning 422. Should use _parse_timestamp or similar pattern to reject bad input explicitly, matching the after param validation in chat.py.","status":"closed","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-08T12:02:57Z","created_by":"Juan Reyero","updated_at":"2026-02-08T12:05:44Z","closed_at":"2026-02-08T12:05:44Z","close_reason":"Fixed: malformed cursor now returns 422"}
{"id":"aweb-pzk","title":"Validate duplicate aliases in to_aliases","description":"In create_or_send (chat.py), duplicate entries in to_aliases are silently deduped via set(). Should validate and reject with a 422 error instead of silently ignoring. From beadhub-3zsl.","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:01:34Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:01:34Z"}
{"id":"aweb-qdg","title":"Design: chained rotations break TOFU — SOT protocol question","description":"If an agent rotates twice before a peer checks inbox, the peer gets only the latest announcement whose old_did doesn't match their pinned DID. This is a protocol design question for the SOT — needs a decision on whether to chain announcements or require intermediate acknowledgment.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-22T00:44:09Z","created_by":"Juan Reyero","updated_at":"2026-02-22T00:44:09Z"}
{"id":"aweb-rwf","title":"Add sender_waiting to SSE message events","description":"Modify _sse_events() in chat.py: Add from_agent_id to both replay and live message SELECT queries. Before yielding each message event, call is_agent_waiting(redis, session_id, from_agent_id). Include 'sender_waiting': bool in the event payload. Tests: test_sse_message_includes_sender_waiting_true — Agent 1 has active SSE, sends message, Agent 2's SSE stream shows sender_waiting: true. test_sse_message_sender_waiting_false_without_redis — With redis=None, always false.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:35:02Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:46:36Z","closed_at":"2026-02-07T23:46:36Z","close_reason":"All endpoints wired, Lua TOCTOU fix, 24 tests passing","dependencies":[{"issue_id":"aweb-rwf","depends_on_id":"aweb-axv","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-sfx","title":"Add did/custody/lifetime fields to agent.created mutation hook context","description":"The agent.created mutation event in bootstrap_identity fires without did, custody, or lifetime in the context dict. Sam has a fix ready but uncommitted.","status":"open","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-22T00:44:17Z","created_by":"Juan Reyero","updated_at":"2026-02-22T00:44:17Z"}
{"id":"aweb-tji","title":"Wire sender_waiting into aweb chat protocol","description":"Agents using aweb chat have no way to know if the other side is actively listening on SSE. sender_waiting is hardcoded to False, targets_connected is hardcoded to []. Wire Redis connection tracking (ZADD/ZREM/ZSCORE) into SSE lifecycle. Separate chat_waiting module following presence.py pattern.","status":"closed","priority":1,"issue_type":"feature","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:34:43Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:48:14Z","closed_at":"2026-02-07T23:48:14Z","close_reason":"All 7 tasks complete, 60 tests passing, package 0.1.2 built"}
{"id":"aweb-tjm","title":"Verify rotation_proof field name against SOT rotation_signature","description":"API uses rotation_proof but SOT may say rotation_signature. Need to verify against spec and align naming. If spec says rotation_signature, rename the API field for consistency.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-22T00:44:26Z","created_by":"Juan Reyero","updated_at":"2026-02-22T00:44:26Z"}
{"id":"aweb-u10","title":"Make TTL/limit constants configurable","description":"Several constants are hardcoded: HANG_ON_EXTENSION_SECONDS=300 (chat.py), max_age_seconds=90 (chat_waiting.py), RESERVATION_MIN/MAX_TTL_SECONDS (reservations.py), DEFAULT_PRESENCE_TTL_SECONDS=1800 (presence.py). Consider making configurable via environment/settings for different deployments. From beadhub-6srg.","status":"open","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:01:58Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:01:58Z"}
{"id":"aweb-upn","title":"Design decision: /v1/init re-init with different DID or without ownership proof","description":"Code review found two related design gaps in /v1/init re-init path: (1) Re-init with same alias but different DID silently returns the original agent's DID — should probably be 409 or 403. (2) Re-init doesn't validate that the caller owns the existing DID (no challenge-response). Both are acceptable for trusted-network-only /v1/init, but need explicit design decision if endpoint is ever exposed publicly. See code review for aweb-fj2.7 findings #3 and #7.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T23:48:58Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:48:58Z"}
{"id":"aweb-usq","title":"Clarify base64 variant in clawdid spec (standard vs URL-safe)","description":"signing.py uses standard base64 (b64encode). The spec says 'standard base64 (RFC 4648, no padding)' which matches. But RFC 4648 §4 (standard) vs §5 (URL-safe) distinction should be explicit in the spec to prevent interop issues with Go/Rust clients. Current code is correct; this is a spec documentation task.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-21T23:47:58Z","created_by":"Juan Reyero","updated_at":"2026-02-21T23:47:58Z"}
{"id":"aweb-w1x","title":"Implement chat MCP tools with SSE wait support","description":"Four chat tools: chat_send (create session + send message, with wait:true holding the MCP connection open and streaming the reply via SSE until the other agent responds), chat_pending (list unread conversations), chat_history (get messages for a session), chat_read (mark messages as read). The wait:true path is critical — it must keep the SSE stream open so the agent can have a real conversation. This is the hardest tool to implement correctly.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-12T13:35:03Z","created_by":"Juan Reyero","updated_at":"2026-02-12T14:53:04Z","closed_at":"2026-02-12T14:53:04Z","close_reason":"Chat tools implemented with wait-for-reply support, capped deadline extensions, comprehensive tests (7 chat tests). Code reviewed.","dependencies":[{"issue_id":"aweb-w1x","depends_on_id":"aweb-8vx","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-w1x","depends_on_id":"aweb-cxj","type":"parent-child","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"},{"issue_id":"aweb-w1x","depends_on_id":"aweb-k8b","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}
{"id":"aweb-xac","title":"Add FK constraint on chat_read_receipts.last_read_message_id","description":"Migration 003 is missing a FK constraint on last_read_message_id. Can allow storing invalid message IDs leading to broken read receipts. Fix: add REFERENCES chat_messages(message_id) ON DELETE SET NULL via new migration. From beadhub-vs15.","status":"open","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-13T01:01:52Z","created_by":"Juan Reyero","updated_at":"2026-02-13T01:01:52Z"}
{"id":"aweb-ye1","title":"Un-hardcode sender_waiting in GET /v1/chat/pending","description":"Modify pending() in chat.py: Add redis=Depends(get_redis). Add agent_id aggregation to the SQL query (alongside existing alias aggregation). For each pending session, call get_waiting_agents() for non-self participants. Set sender_waiting = len(waiting) \u003e 0. Tests: test_pending_sender_waiting_true — Agent 1 sends + has active SSE, Agent 2's pending shows sender_waiting: True. test_pending_sender_waiting_false_no_sse — Agent 1 sends but no SSE, Agent 2's pending shows sender_waiting: False.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-07T23:35:06Z","created_by":"Juan Reyero","updated_at":"2026-02-07T23:46:36Z","closed_at":"2026-02-07T23:46:36Z","close_reason":"All endpoints wired, Lua TOCTOU fix, 24 tests passing","dependencies":[{"issue_id":"aweb-ye1","depends_on_id":"aweb-axv","type":"blocks","created_at":"2026-02-18T16:29:00Z","created_by":"bootstrap","metadata":"{}"}]}

{"id":"aweb-2n8","title":"Prepare aweb for PyPI publication","description":"Fix all issues needed before publishing aweb to PyPI: duplicate migrations in wheel, missing routes/__init__.py, missing project.urls/classifiers, add dep minimum versions, rework README for consumers.","status":"in_progress","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-03T23:08:15.096555Z","created_by":"Juan Reyero","updated_at":"2026-02-03T23:08:18.432366Z"}
{"id":"aweb-91t","title":"Restore heartbeat endpoint lost in beadhub refactoring","description":"POST /v1/workspaces/heartbeat was dropped when beadhub was refactored from beadhub-main. The presence.py module and its tests survived intact, and routes that call into presence (register, mcp, status, agent listing) still work. But the heartbeat endpoint itself (~249 lines in beadhub-main workspaces.py lines 518-766) is missing.\n\nThe heartbeat endpoint is what the bdh CLI calls to refresh workspace presence. Without it, presence data goes stale and is never refreshed.\n\nReference implementation: beadhub-main/src/beadhub/routes/workspaces.py (search for 'heartbeat').\nRefactored codebase missing it: beadhub/src/beadhub/routes/workspaces.py.\n\nSteps the endpoint performs:\n1. Extract project_id from auth\n2. Pre-check workspace immutability (project_id + alias match)\n3. Resolve/create repo record (normalize git origin)\n4. Upsert workspace record in SQL (immutability constraints, alias collision check via DB + Redis)\n5. Update presence in Redis (best-effort) — hash + secondary indexes\n6. Cloud-only: track usage (non-blocking)\n7. Return OK\n\nPhilosophy: presence is a cache of SQL. SQL authoritative, Redis ephemeral.\n\nNote: only restore the beadhub-specific heartbeat. We discussed with Juan whether presence should live in aweb — conclusion is that workspace-level presence is beadhub-specific (repos, branches, workspace paths). Generic agent-level presence for aweb is a separate future concern.","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:27:12.392001Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:27:57.213214Z","closed_at":"2026-02-04T09:27:57.213214Z","close_reason":"Created in wrong beads database (aweb instead of beadhub). Grace will create the issue in beadhub's beads."}
{"id":"aweb-acs","title":"aweb: replace assert with explicit check in chat session creation","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-03T13:57:43.667323Z","created_by":"Juan Reyero","updated_at":"2026-02-03T14:08:13.753577Z","closed_at":"2026-02-03T14:08:13.753577Z","close_reason":"Replaced assert with explicit check + HTTPException(500) + logging in _ensure_session()"}
{"id":"aweb-col","title":"aweb: fail fast when proxy headers trusted but internal secret missing","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-03T13:57:43.044041Z","created_by":"Juan Reyero","updated_at":"2026-02-03T14:05:48.098992Z","closed_at":"2026-02-03T14:05:48.098992Z","close_reason":"Removed SESSION_SECRET_KEY fallback from _get_aweb_internal_auth_secret(); added validate_auth_config() for startup checks; added logging on runtime failure; added 5 tests to lock behavior"}
{"id":"aweb-gkv","title":"Epic: Agent-level presence and heartbeat for aweb","description":"aweb needs agent-level presence so that:\n- aw list-agents returns accurate online status (currently always offline)\n- Chat/mail senders can check recipient availability\n- beadhub's workspace heartbeat can sync to aweb's agent presence\n\nArchitecture: Redis-backed presence with TTL at the agent_id level. Simpler than beadhub's workspace presence (no repos, branches, workspace paths). beadhub's workspace heartbeat should also update aweb's agent presence as a side-effect.\n\nIncludes aweb server changes and aw Go client changes. beadhub integration tracked separately in beadhub's beads.","status":"open","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:30:28.174748Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:38:17.633072Z"}
{"id":"aweb-gkv.1","title":"Add GET /v1/agents endpoint","description":"aweb has no agent listing endpoint. The aw Go client (agents.go) calls GET /v1/agents and expects a ListAgentsResponse with project_id and a list of AgentView (agent_id, alias, human_name, agent_type, status, last_seen, online).\n\nThe endpoint should:\n- Require auth (Bearer API key)\n- Scope to the authenticated project_id\n- Query the agents table for all non-deleted agents in the project\n- Return the list matching the AgentView shape from aw/agents.go\n\nThis is needed independently of presence — even without online status, users need to list agents in their project.\n\nNote: the online/last_seen fields will be empty until presence is implemented (aweb-gkv children).","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:11.800491Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:39:11.800491Z","dependencies":[{"issue_id":"aweb-gkv.1","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-04T09:39:11.801324Z","created_by":"Juan Reyero"}]}
{"id":"aweb-gkv.2","title":"Add agent presence module (Redis)","description":"Create src/aweb/presence.py — a Redis-backed agent presence module. Simpler than beadhub's workspace presence (no repos, branches, workspace paths).\n\nRedis data structures:\n- presence:agent:{agent_id} → Hash {agent_id, alias, project_id, status, last_seen} with TTL (default 30 min)\n- idx:project_agents:{project_id} → Set of agent_ids with active presence (2x TTL for lazy cleanup)\n\nFunctions needed:\n- update_agent_presence(redis, agent_id, alias, project_id, status='active', ttl_seconds=1800) → timestamp\n- get_agent_presence(redis, agent_id) → Optional dict\n- list_agent_presences_by_project(redis, project_id) → List of dicts\n- list_agent_presences_by_ids(redis, agent_ids) → List of dicts (for enriching agent listings)\n- clear_agent_presence(redis, agent_ids) → count deleted\n\nFollow the patterns from beadhub-main's presence.py but strip all workspace/repo/branch-specific code. Keep: URL-encoded key components, lazy stale index cleanup, pipeline batching, 2x TTL on indexes.\n\nRedis is optional in aweb (app.state.redis can be None). All presence functions must handle redis=None gracefully (return empty results).","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:22.843454Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:39:22.843454Z","dependencies":[{"issue_id":"aweb-gkv.2","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-04T09:39:22.84469Z","created_by":"Juan Reyero"}]}
{"id":"aweb-gkv.3","title":"Add POST /v1/agents/heartbeat endpoint","description":"Add a heartbeat endpoint that agents call to report liveness.\n\nPOST /v1/agents/heartbeat\n- Requires auth (Bearer API key) → resolves project_id and agent_id\n- Request body: optional fields (status: str)\n- Calls update_agent_presence() from the presence module\n- Returns {agent_id, last_seen, ttl_seconds}\n- Best-effort: if Redis is unavailable, log warning and return success (SQL is authoritative, presence is a cache)\n\nThis is simpler than beadhub's workspace heartbeat — no repo resolution, no immutability checks, no SQL upsert. Just 'I am alive, refresh my TTL.'\n\nDepends on: aweb-gkv.2 (presence module)","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:30.701439Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:39:30.701439Z","dependencies":[{"issue_id":"aweb-gkv.3","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-04T09:39:30.702672Z","created_by":"Juan Reyero"},{"issue_id":"aweb-gkv.3","depends_on_id":"aweb-gkv.2","type":"blocks","created_at":"2026-02-04T09:39:55.399046Z","created_by":"Juan Reyero"}]}
{"id":"aweb-gkv.4","title":"Enrich GET /v1/agents with online status from presence","description":"Update the GET /v1/agents endpoint (aweb-gkv.1) to enrich agent listings with online/last_seen from the presence module (aweb-gkv.2).\n\nAfter fetching agents from the DB, call list_agent_presences_by_ids() to get presence data. For each agent, set:\n- online: bool (true if presence exists and not expired)\n- last_seen: ISO timestamp from presence, or null\n\nWhen Redis is unavailable (app.state.redis is None), online=false and last_seen=null for all agents.\n\nThe aw Go client's AgentView struct already expects these fields:\n  Online    bool   json:online\n  LastSeen  string json:last_seen,omitempty\n  Status    string json:status,omitempty\n\nDepends on: aweb-gkv.1 (agents endpoint), aweb-gkv.2 (presence module)","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:38.534055Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:39:38.534055Z","dependencies":[{"issue_id":"aweb-gkv.4","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-04T09:39:38.53538Z","created_by":"Juan Reyero"},{"issue_id":"aweb-gkv.4","depends_on_id":"aweb-gkv.1","type":"blocks","created_at":"2026-02-04T09:39:55.751536Z","created_by":"Juan Reyero"},{"issue_id":"aweb-gkv.4","depends_on_id":"aweb-gkv.2","type":"blocks","created_at":"2026-02-04T09:39:56.098844Z","created_by":"Juan Reyero"}]}
{"id":"aweb-gkv.5","title":"aw client: add Heartbeat() method","description":"Add a Heartbeat() method to the aw Go client (aw/client.go).\n\nfunc (c *Client) Heartbeat(ctx context.Context, req *HeartbeatRequest) (*HeartbeatResponse, error)\n\ntype HeartbeatRequest struct {\n    Status string `json:\"status,omitempty\"`\n}\n\ntype HeartbeatResponse struct {\n    AgentID  string `json:\"agent_id\"`\n    LastSeen string `json:\"last_seen\"`\n    TTL      int    `json:\"ttl_seconds\"`\n}\n\nCalls POST /v1/agents/heartbeat with Bearer API key auth.\n\nDepends on: aweb-gkv.3 (heartbeat endpoint exists)","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:43.994535Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:39:43.994535Z","dependencies":[{"issue_id":"aweb-gkv.5","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-04T09:39:43.995804Z","created_by":"Juan Reyero"},{"issue_id":"aweb-gkv.5","depends_on_id":"aweb-gkv.3","type":"blocks","created_at":"2026-02-04T09:39:56.442346Z","created_by":"Juan Reyero"}]}
{"id":"aweb-gkv.6","title":"aw CLI: call heartbeat on every command","description":"Integrate heartbeat into the aw CLI (aw/cmd/aw/main.go), similar to how bdh calls refreshPresenceHeartbeat() on every command.\n\nOn every aw CLI invocation:\n1. Load config (API key, base URL)\n2. Call client.Heartbeat() in a goroutine (best-effort, non-blocking)\n3. Don't fail the command if heartbeat fails (log warning at most)\n\nThis ensures that any agent using aw stays visible in presence as long as they're actively running commands.\n\nDepends on: aweb-gkv.5 (aw client Heartbeat method)","status":"open","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:39:50.555585Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:39:50.555585Z","dependencies":[{"issue_id":"aweb-gkv.6","depends_on_id":"aweb-gkv","type":"parent-child","created_at":"2026-02-04T09:39:50.556385Z","created_by":"Juan Reyero"},{"issue_id":"aweb-gkv.6","depends_on_id":"aweb-gkv.5","type":"blocks","created_at":"2026-02-04T09:39:56.788181Z","created_by":"Juan Reyero"}]}
